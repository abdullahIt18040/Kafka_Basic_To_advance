## Kafka Cluster ржХрзА?

Cluster have Nodes or servers and each node have bootstrap server port like 9092 ,and bootstrap controller  port : like 9093


> bootstrap server port used , connect consumer and producer
> bootstrap controller port used to communication among servers or nodes in cluster


 Kafka Cluster рж╣рж▓рзЛ ржПржХрж╛ржзрж┐ржХ Kafka Broker (server)-ржПрж░ ржПржХржЯрж┐ ржжрж▓, ржпрж╛рж░рж╛ ржПржХрж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рзЗ message рж╕ржВрж░ржХрзНрж╖ржг, ржкрзНрж░рзЗрж░ржг ржУ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржХрж░ржгрзЗрж░ ржЬржирзНржпред

ржЕрж░рзНржерж╛рзО, Kafka Cluster = ржЕржирзЗржХржЧрзБрж▓рзЛ Broker ржорж┐рж▓рзЗ ржЧржарж┐ржд ржПржХржЯрж┐ ржмрзЬ рж╕рж┐рж╕рзНржЯрзЗржоред
```
тЪЩя╕П Kafka Cluster-ржПрж░ ржорзВрж▓ ржЕржВрж╢ржЧрзБрж▓рзЛ:
ржЕржВрж╢	ржХрж╛ржЬ
Broker	Kafka-ржПрж░ ржорзВрж▓ рж╕рж╛рж░рзНржнрж╛рж░, ржпрзЗржЦрж╛ржирзЗ message рж╕ржВрж░ржХрзНрж╖ржг рж╣рзЯред ржкрзНрж░рждрж┐ржЯрж┐ broker ржПржХржЯрж┐ ID ржкрж╛рзЯ (ржпрзЗржоржи broker-1, broker-2, broker-3)ред
Topic	ржбрзЗржЯрж╛ рж░рж╛ржЦрж╛рж░ ржЬржирзНржп рж▓ржЬрж┐ржХрзНржпрж╛рж▓ ржирж╛ржо ржмрж╛ ржХрзНржпрж╛ржЯрзЗржЧрж░рж┐ (ржпрзЗржоржи orders, payments)ред
Partition	ржкрзНрж░рждрж┐ржЯрж┐ topic ржЫрзЛржЯ ржЫрзЛржЯ ржнрж╛ржЧрзЗ ржнрж╛ржЧ рж╣рзЯред
Producer	ржпрзЗ Kafka-рждрзЗ data ржкрж╛ржарж╛рзЯ (write ржХрж░рзЗ)ред
Consumer	ржпрзЗ Kafka ржерзЗржХрзЗ data ржкрзЬрзЗ (read ржХрж░рзЗ)ред
Controller (ZooKeeper ржмрж╛ KRaft)	Cluster-ржПрж░ leader ржирж┐рж░рзНржмрж╛ржЪржи ржУ broker рж╕ржоржирзНржмрзЯ ржХрж░рзЗред
ЁЯзй ржПржХржЯрж┐ ржЙржжрж╛рж╣рж░ржг ржжрж┐рзЯрзЗ ржмрзЛржЭрж╛ ржпрж╛ржХ:

ржзрж░рзБржи, ржЖржкржирж╛рж░ Kafka Cluster-ржП рзйржЯрж┐ broker ржЖржЫрзЗ ЁЯСЗ

Broker	Port	Description
Broker 1	9092	Topic partition-0
Broker 2	9093	Topic partition-1
Broker 3	9094	Topic partition-2

ЁЯУж ржЖржкржирж┐ ржпржжрж┐ orders ржирж╛ржорзЗрж░ ржПржХржЯрж┐ topic рждрзИрж░рж┐ ржХрж░рзЗржи ржПржмржВ рж╕рзЗржЯрж┐рждрзЗ рзйржЯрж┐ partition ржжрзЗржи тАФ
рждрж╛рж╣рж▓рзЗ ржкрзНрж░рждрж┐ржЯрж┐ partition ржЖрж▓рж╛ржжрж╛ broker-ржП рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржмрзЗред

ЁЯСЙ ржПрждрзЗ ржбрзЗржЯрж╛ distributed рж╣рзЯрзЗ ржпрж╛рзЯ, ржПржмржВ load balancing рж╣рзЯред

ЁЯФБ Fault Tolerance (рждрзНрж░рзБржЯрж┐ рж╕рж╣ржирж╢рзАрж▓рждрж╛):

Kafka Cluster-ржПрж░ ржмрзЬ рж╕рзБржмрж┐ржзрж╛ рж╣рж▓рзЛ тАФ
ржпржжрж┐ ржХрзЛржирзЛ broker ржмржирзНржз рж╣рзЯрзЗ ржпрж╛рзЯ, ржЕржирзНржп broker рждрж╛рж░ replica ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред
ржПржЯрж╛ржЗ replication ржПржмржВ fault tolerance ржПрж░ ржорзВрж▓ ржЙржжрзНржжрзЗрж╢рзНржпред

ЁЯЪА Kafka Cluster-ржПрж░ рж╕рзБржмрж┐ржзрж╛:
рж╕рзБржмрж┐ржзрж╛	ржмрзНржпрж╛ржЦрзНржпрж╛
тЪб Scalability	ржмрзЗрж╢рж┐ рж▓рзЛржб рж╕рж╛ржорж▓рж╛рждрзЗ ржирждрзБржи broker ржпрзЛржЧ ржХрж░рж╛ ржпрж╛рзЯред
ЁЯЫбя╕П Fault Tolerance	ржХрзЛржирзЛ broker ржмржирзНржз рж╣рж▓рзЗ ржЕржирзНржп broker ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржирзЗрзЯред
ЁЯУИ High Throughput	ржПржХрж╛ржзрж┐ржХ partition parallel ржнрж╛ржмрзЗ message рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рзЗред
ЁЯФЧ Replication	ржбрзЗржЯрж╛рж░ ржХржкрж┐ ржмрж┐ржнрж┐ржирзНржи broker-ржП ржерж╛ржХрзЗ, ржлрж▓рзЗ ржбрзЗржЯрж╛ рж╣рж╛рж░рж╛рзЯ ржирж╛ред
ЁЯЦея╕П Local Cluster (Single-node)

ржпржжрж┐ ржЖржкржирж┐ рж╢рзБржзрзБ ржирж┐ржЬрзЗрж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ Kafka ржЪрж╛рж▓рж╛ржи (ржПржХржЯрж╛ broker), рждрж╛ржУ рж╕рзЗржЯрж╛ ржПржХржЯрж╛ single-node clusterред
Production рж╕рж┐рж╕рзНржЯрзЗржорзЗ рж╕рж╛ржзрж╛рж░ржгржд рзй ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐ broker ржерж╛ржХрзЗред
```
рж╕ржВржХрзНрж╖рзЗржкрзЗ ржмрж╛ржВрж▓рж╛ рж╕ржВржЬрзНржЮрж╛:
Kafka Cluster рж╣рж▓рзЛ ржПржХрж╛ржзрж┐ржХ Kafka Broker-ржПрж░ рж╕ржоржирзНржмрзЯрзЗ ржЧржарж┐ржд ржПржХржЯрж┐ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрзЗржб рж╕рж┐рж╕рзНржЯрзЗржо, ржпрзЗржЦрж╛ржирзЗ ржбрзЗржЯрж╛ ржнрж╛ржЧ рж╣рзЯрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣рзЯ ржПржмржВ ржХрзЛржирзЛ рж╕рж╛рж░рзНржнрж╛рж░ ржирж╖рзНржЯ рж╣рж▓рзЗржУ рж╕рж┐рж╕рзНржЯрзЗржо ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

ржЪржорзОржХрж╛рж░ ржкрзНрж░рж╢рзНржи ЁЯСН
Kafka-рждрзЗ тАЬQuorumтАЭ (ржЙржЪрзНржЪрж╛рж░ржг: ржХрзЛрж░рж╛ржо) ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржзрж╛рж░ржгрж╛, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ KRaft mode-ржП (Kafka Raft metadata mode)ред
ржЪрж▓рзБржи рж╕рж╣ржЬ ржмрж╛ржВрж▓рж╛рзЯ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рж┐ ЁЯСЗ

 ## Kafka Quorum ржХрзА?
```
Quorum ржорж╛ржирзЗ рж╣рж▓рзЛ тАФ
ржПржХржЯрж┐ group ржмрж╛ ржжрж▓, ржпрж╛рж░рж╛ ржПржХрж╕рж╛ржерзЗ Kafka cluster-ржПрж░ metadata ржмрж╛ control рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗрзЯред

Kafka ржпржЦржи ZooKeeper ржмрж╛ржж ржжрж┐рзЯрзЗ ржирж┐ржЬрж╕рзНржм KRaft (Kafka Raft) рж╕рж┐рж╕рзНржЯрзЗржорзЗ ржЪрж▓рзЗ ржЖрж╕рзЗ,
рждржЦржи metadata management ржПржЗ quorum-ржнрж┐рждрзНрждрж┐ржХ system ржжрзНржмрж╛рж░рж╛ ржкрж░рж┐ржЪрж╛рж▓рж┐ржд рж╣рзЯред

тЪЩя╕П Quorum-ржПрж░ ржХрж╛ржЬ ржХрзА?

Kafka Cluster-ржПрж░ ржоржзрзНржпрзЗ ржХрзЯрзЗржХржЯрж┐ broker ржерж╛ржХрзЗ ржпрж╛рж░рж╛ controller рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред
ржПрж░рж╛ ржорж┐рж▓рзЗ ржПржХржЯрж┐ Quorum рждрзИрж░рж┐ ржХрж░рзЗред

ржПржЗ quorum-ржПрж░ ржХрж╛ржЬ рж╣рж▓рзЛ тАФ

ржХрзЗ controller рж╣ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛

cluster-ржПрж░ metadata (topic, partition, broker info ржЗрждрзНржпрж╛ржжрж┐) рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛

failover рж╣рж▓рзЗ ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рж╛

ЁЯзй рж╕рж╣ржЬ ржЙржжрж╛рж╣рж░ржг:

ржзрж░рзБржи ржЖржкржирж╛рж░ Kafka cluster-ржП рзйржЯрж┐ controller ржЖржЫрзЗ ЁЯСЗ

Controller ID	Role
1	Leader
2	Follower
3	Follower

ржПрж░рж╛ ржорж┐рж▓рзЗ ржПржХржЯрж┐ Quorum ржЧржаржи ржХрж░рзЗред

ржпржжрж┐ leader controller (1) ржирж╖рзНржЯ рж╣рзЯрзЗ ржпрж╛рзЯ, рждрж╛рж╣рж▓рзЗ quorum-ржПрж░ ржмрж╛ржХрж┐ рж╕ржжрж╕рзНржпрж░рж╛ ржнрзЛржЯ ржжрж┐рзЯрзЗ (Raft consensus) ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░ржмрзЗред

тЬЕ ржПрж░ ржлрж▓рзЗ Kafka ржЪрж▓рждрзЗ ржерж╛ржХрзЗ тАФ рж╕рж┐рж╕рзНржЯрзЗржо ржмржирзНржз рж╣рзЯ ржирж╛ред

ЁЯФБ Quorum ржХрзЗржи ржжрж░ржХрж╛рж░:
ржХрж╛рж░ржг	ржмрзНржпрж╛ржЦрзНржпрж╛
ЁЯЫбя╕П Fault Tolerance	ржХрзЛржирзЛ controller ржирж╖рзНржЯ рж╣рж▓рзЗржУ quorum ржмрж╛ржХрж┐рж░рж╛ ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗред
ЁЯУК Consistency	рж╕ржм controller ржПржХржЗ metadata рж░рж╛ржЦрзЗ, ржпрж╛рждрзЗ ржХрзЛржирзЛ ржЕрж╕ржЩрзНржЧрждрж┐ ржирж╛ рж╣рзЯред
тЪЩя╕П ZooKeeper-ржПрж░ ржмрж┐ржХрж▓рзНржк	Kafka ржПржЦржи ржирж┐ржЬрзЗржЗ metadata ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, ZooKeeper ржЫрж╛рзЬрж╛ржЗред
тЪЩя╕П Quorum ржХрж┐ржнрж╛ржмрзЗ ржжрзЗржЦрж╛ ржпрж╛рзЯ (Windows):

Kafka ржпржжрж┐ KRaft mode-ржП ржЪрж▓рзЗ, рждрж╛рж╣рж▓рзЗ ржЖржкржирж┐ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ quorum-ржПрж░ ржЕржмрж╕рзНржерж╛ ржжрзЗржЦрждрзЗ ржкрж╛рж░рзЗржи ЁЯСЗ

C:\kafka>.\bin\windows\kafka-metadata-quorum.bat --bootstrap-controller localhost:9093 describe --status

ЁЯУЛ Output (ржЙржжрж╛рж╣рж░ржг):
ClusterId: F6Yh3kQ0Tq2wQ
LeaderId: 1
LeaderEpoch: 5
HighWatermark: 20
Voters: [1,2,3]
Observers: []


LeaderId: ржмрж░рзНрждржорж╛ржирзЗ ржХрзЗ controller leader
Voters: ржХрзЛржи ржХрзЛржи broker controller рж╣рж┐рж╕рзЗржмрзЗ ржнрзЛржЯрзЗ ржЕржВрж╢ ржирж┐ржЪрзНржЫрзЗ
HighWatermark: Raft log ржХрждржЯрж╛ ржкрж░рзНржпржирзНржд рж╕рж┐ржЩрзНржХ рж╣рзЯрзЗржЫрзЗ

ЁЯза рж╕ржВржХрзНрж╖рзЗржкрзЗ ржмрж╛ржВрж▓рж╛ рж╕ржВржЬрзНржЮрж╛:

Kafka Quorum рж╣рж▓рзЛ Kafka-ржПрж░ controller ржирзЛржбржЧрзБрж▓рзЛрж░ ржПржХржЯрж┐ ржжрж▓, ржпрж╛рж░рж╛ Raft algorithm ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ cluster-ржПрж░ metadata ржУ leader ржирж┐рж░рзНржмрж╛ржЪржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, ржпрж╛рждрзЗ ржХрзЛржирзЛ node ржирж╖рзНржЯ рж╣рж▓рзЗржУ cluster ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗред

```
