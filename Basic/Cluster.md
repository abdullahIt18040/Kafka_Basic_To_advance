## Kafka Cluster ржХрзА?

Cluster have Nodes or servers and each node have bootstrap server port like 9092 ,and bootstrap controller  port : like 9093


> bootstrap server port used , connect consumer and producer
> bootstrap controller port used to communication among servers or nodes in cluster


 Kafka Cluster рж╣рж▓рзЛ ржПржХрж╛ржзрж┐ржХ Kafka Broker (server)-ржПрж░ ржПржХржЯрж┐ ржжрж▓, ржпрж╛рж░рж╛ ржПржХрж╕рж╛ржерзЗ ржХрж╛ржЬ ржХрж░рзЗ message рж╕ржВрж░ржХрзНрж╖ржг, ржкрзНрж░рзЗрж░ржг ржУ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ржХрж░ржгрзЗрж░ ржЬржирзНржпред

ржЕрж░рзНржерж╛рзО, Kafka Cluster = ржЕржирзЗржХржЧрзБрж▓рзЛ Broker ржорж┐рж▓рзЗ ржЧржарж┐ржд ржПржХржЯрж┐ ржмрзЬ рж╕рж┐рж╕рзНржЯрзЗржоред
```
тЪЩя╕П Kafka Cluster-ржПрж░ ржорзВрж▓ ржЕржВрж╢ржЧрзБрж▓рзЛ:
ржЕржВрж╢	ржХрж╛ржЬ
Broker	Kafka-ржПрж░ ржорзВрж▓ рж╕рж╛рж░рзНржнрж╛рж░, ржпрзЗржЦрж╛ржирзЗ message рж╕ржВрж░ржХрзНрж╖ржг рж╣рзЯред ржкрзНрж░рждрж┐ржЯрж┐ broker ржПржХржЯрж┐ ID ржкрж╛рзЯ (ржпрзЗржоржи broker-1, broker-2, broker-3)ред
Topic	ржбрзЗржЯрж╛ рж░рж╛ржЦрж╛рж░ ржЬржирзНржп рж▓ржЬрж┐ржХрзНржпрж╛рж▓ ржирж╛ржо ржмрж╛ ржХрзНржпрж╛ржЯрзЗржЧрж░рж┐ (ржпрзЗржоржи orders, payments)ред
Partition	ржкрзНрж░рждрж┐ржЯрж┐ topic ржЫрзЛржЯ ржЫрзЛржЯ ржнрж╛ржЧрзЗ ржнрж╛ржЧ рж╣рзЯред
Producer	ржпрзЗ Kafka-рждрзЗ data ржкрж╛ржарж╛рзЯ (write ржХрж░рзЗ)ред
Consumer	ржпрзЗ Kafka ржерзЗржХрзЗ data ржкрзЬрзЗ (read ржХрж░рзЗ)ред
Controller (ZooKeeper ржмрж╛ KRaft)	Cluster-ржПрж░ leader ржирж┐рж░рзНржмрж╛ржЪржи ржУ broker рж╕ржоржирзНржмрзЯ ржХрж░рзЗред
ЁЯзй ржПржХржЯрж┐ ржЙржжрж╛рж╣рж░ржг ржжрж┐рзЯрзЗ ржмрзЛржЭрж╛ ржпрж╛ржХ:

ржзрж░рзБржи, ржЖржкржирж╛рж░ Kafka Cluster-ржП рзйржЯрж┐ broker ржЖржЫрзЗ ЁЯСЗ

Broker	Port	Description
Broker 1	9092	Topic partition-0
Broker 2	9093	Topic partition-1
Broker 3	9094	Topic partition-2

ЁЯУж ржЖржкржирж┐ ржпржжрж┐ orders ржирж╛ржорзЗрж░ ржПржХржЯрж┐ topic рждрзИрж░рж┐ ржХрж░рзЗржи ржПржмржВ рж╕рзЗржЯрж┐рждрзЗ рзйржЯрж┐ partition ржжрзЗржи тАФ
рждрж╛рж╣рж▓рзЗ ржкрзНрж░рждрж┐ржЯрж┐ partition ржЖрж▓рж╛ржжрж╛ broker-ржП рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣ржмрзЗред

ЁЯСЙ ржПрждрзЗ ржбрзЗржЯрж╛ distributed рж╣рзЯрзЗ ржпрж╛рзЯ, ржПржмржВ load balancing рж╣рзЯред

ЁЯФБ Fault Tolerance (рждрзНрж░рзБржЯрж┐ рж╕рж╣ржирж╢рзАрж▓рждрж╛):

Kafka Cluster-ржПрж░ ржмрзЬ рж╕рзБржмрж┐ржзрж╛ рж╣рж▓рзЛ тАФ
ржпржжрж┐ ржХрзЛржирзЛ broker ржмржирзНржз рж╣рзЯрзЗ ржпрж╛рзЯ, ржЕржирзНржп broker рждрж╛рж░ replica ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред
ржПржЯрж╛ржЗ replication ржПржмржВ fault tolerance ржПрж░ ржорзВрж▓ ржЙржжрзНржжрзЗрж╢рзНржпред

ЁЯЪА Kafka Cluster-ржПрж░ рж╕рзБржмрж┐ржзрж╛:
рж╕рзБржмрж┐ржзрж╛	ржмрзНржпрж╛ржЦрзНржпрж╛
тЪб Scalability	ржмрзЗрж╢рж┐ рж▓рзЛржб рж╕рж╛ржорж▓рж╛рждрзЗ ржирждрзБржи broker ржпрзЛржЧ ржХрж░рж╛ ржпрж╛рзЯред
ЁЯЫбя╕П Fault Tolerance	ржХрзЛржирзЛ broker ржмржирзНржз рж╣рж▓рзЗ ржЕржирзНржп broker ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржирзЗрзЯред
ЁЯУИ High Throughput	ржПржХрж╛ржзрж┐ржХ partition parallel ржнрж╛ржмрзЗ message рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рзЗред
ЁЯФЧ Replication	ржбрзЗржЯрж╛рж░ ржХржкрж┐ ржмрж┐ржнрж┐ржирзНржи broker-ржП ржерж╛ржХрзЗ, ржлрж▓рзЗ ржбрзЗржЯрж╛ рж╣рж╛рж░рж╛рзЯ ржирж╛ред
ЁЯЦея╕П Local Cluster (Single-node)

ржпржжрж┐ ржЖржкржирж┐ рж╢рзБржзрзБ ржирж┐ржЬрзЗрж░ ржХржорзНржкрж┐ржЙржЯрж╛рж░рзЗ Kafka ржЪрж╛рж▓рж╛ржи (ржПржХржЯрж╛ broker), рждрж╛ржУ рж╕рзЗржЯрж╛ ржПржХржЯрж╛ single-node clusterред
Production рж╕рж┐рж╕рзНржЯрзЗржорзЗ рж╕рж╛ржзрж╛рж░ржгржд рзй ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐ broker ржерж╛ржХрзЗред
```
рж╕ржВржХрзНрж╖рзЗржкрзЗ ржмрж╛ржВрж▓рж╛ рж╕ржВржЬрзНржЮрж╛:
Kafka Cluster рж╣рж▓рзЛ ржПржХрж╛ржзрж┐ржХ Kafka Broker-ржПрж░ рж╕ржоржирзНржмрзЯрзЗ ржЧржарж┐ржд ржПржХржЯрж┐ ржбрж┐рж╕рзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрзЗржб рж╕рж┐рж╕рзНржЯрзЗржо, ржпрзЗржЦрж╛ржирзЗ ржбрзЗржЯрж╛ ржнрж╛ржЧ рж╣рзЯрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд рж╣рзЯ ржПржмржВ ржХрзЛржирзЛ рж╕рж╛рж░рзНржнрж╛рж░ ржирж╖рзНржЯ рж╣рж▓рзЗржУ рж╕рж┐рж╕рзНржЯрзЗржо ржХрж╛ржЬ ржЪрж╛рж▓рж┐рзЯрзЗ ржпрзЗрждрзЗ ржкрж╛рж░рзЗред

ржЪржорзОржХрж╛рж░ ржкрзНрж░рж╢рзНржи ЁЯСН
Kafka-рждрзЗ тАЬQuorumтАЭ (ржЙржЪрзНржЪрж╛рж░ржг: ржХрзЛрж░рж╛ржо) ржПржХржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг ржзрж╛рж░ржгрж╛, ржмрж┐рж╢рзЗрж╖ ржХрж░рзЗ KRaft mode-ржП (Kafka Raft metadata mode)ред
ржЪрж▓рзБржи рж╕рж╣ржЬ ржмрж╛ржВрж▓рж╛рзЯ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░рж┐ ЁЯСЗ

 ## Kafka Quorum ржХрзА?
```
Quorum ржорж╛ржирзЗ рж╣рж▓рзЛ тАФ
ржПржХржЯрж┐ group ржмрж╛ ржжрж▓, ржпрж╛рж░рж╛ ржПржХрж╕рж╛ржерзЗ Kafka cluster-ржПрж░ metadata ржмрж╛ control рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗрзЯред

Kafka ржпржЦржи ZooKeeper ржмрж╛ржж ржжрж┐рзЯрзЗ ржирж┐ржЬрж╕рзНржм KRaft (Kafka Raft) рж╕рж┐рж╕рзНржЯрзЗржорзЗ ржЪрж▓рзЗ ржЖрж╕рзЗ,
рждржЦржи metadata management ржПржЗ quorum-ржнрж┐рждрзНрждрж┐ржХ system ржжрзНржмрж╛рж░рж╛ ржкрж░рж┐ржЪрж╛рж▓рж┐ржд рж╣рзЯред

тЪЩя╕П Quorum-ржПрж░ ржХрж╛ржЬ ржХрзА?

Kafka Cluster-ржПрж░ ржоржзрзНржпрзЗ ржХрзЯрзЗржХржЯрж┐ broker ржерж╛ржХрзЗ ржпрж╛рж░рж╛ controller рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред
ржПрж░рж╛ ржорж┐рж▓рзЗ ржПржХржЯрж┐ Quorum рждрзИрж░рж┐ ржХрж░рзЗред

ржПржЗ quorum-ржПрж░ ржХрж╛ржЬ рж╣рж▓рзЛ тАФ

ржХрзЗ controller рж╣ржмрзЗ рждрж╛ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛

cluster-ржПрж░ metadata (topic, partition, broker info ржЗрждрзНржпрж╛ржжрж┐) рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛

failover рж╣рж▓рзЗ ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рж╛

ЁЯзй рж╕рж╣ржЬ ржЙржжрж╛рж╣рж░ржг:

ржзрж░рзБржи ржЖржкржирж╛рж░ Kafka cluster-ржП рзйржЯрж┐ controller ржЖржЫрзЗ ЁЯСЗ

Controller ID	Role
1	Leader
2	Follower
3	Follower

ржПрж░рж╛ ржорж┐рж▓рзЗ ржПржХржЯрж┐ Quorum ржЧржаржи ржХрж░рзЗред

ржпржжрж┐ leader controller (1) ржирж╖рзНржЯ рж╣рзЯрзЗ ржпрж╛рзЯ, рждрж╛рж╣рж▓рзЗ quorum-ржПрж░ ржмрж╛ржХрж┐ рж╕ржжрж╕рзНржпрж░рж╛ ржнрзЛржЯ ржжрж┐рзЯрзЗ (Raft consensus) ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░ржмрзЗред

тЬЕ ржПрж░ ржлрж▓рзЗ Kafka ржЪрж▓рждрзЗ ржерж╛ржХрзЗ тАФ рж╕рж┐рж╕рзНржЯрзЗржо ржмржирзНржз рж╣рзЯ ржирж╛ред

ЁЯФБ Quorum ржХрзЗржи ржжрж░ржХрж╛рж░:
ржХрж╛рж░ржг	ржмрзНржпрж╛ржЦрзНржпрж╛
ЁЯЫбя╕П Fault Tolerance	ржХрзЛржирзЛ controller ржирж╖рзНржЯ рж╣рж▓рзЗржУ quorum ржмрж╛ржХрж┐рж░рж╛ ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗред
ЁЯУК Consistency	рж╕ржм controller ржПржХржЗ metadata рж░рж╛ржЦрзЗ, ржпрж╛рждрзЗ ржХрзЛржирзЛ ржЕрж╕ржЩрзНржЧрждрж┐ ржирж╛ рж╣рзЯред
тЪЩя╕П ZooKeeper-ржПрж░ ржмрж┐ржХрж▓рзНржк	Kafka ржПржЦржи ржирж┐ржЬрзЗржЗ metadata ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, ZooKeeper ржЫрж╛рзЬрж╛ржЗред
тЪЩя╕П Quorum ржХрж┐ржнрж╛ржмрзЗ ржжрзЗржЦрж╛ ржпрж╛рзЯ (Windows):

Kafka ржпржжрж┐ KRaft mode-ржП ржЪрж▓рзЗ, рждрж╛рж╣рж▓рзЗ ржЖржкржирж┐ ржирж┐ржЪрзЗрж░ ржХржорж╛ржирзНржб ржжрж┐рзЯрзЗ quorum-ржПрж░ ржЕржмрж╕рзНржерж╛ ржжрзЗржЦрждрзЗ ржкрж╛рж░рзЗржи ЁЯСЗ

C:\kafka>.\bin\windows\kafka-metadata-quorum.bat --bootstrap-controller localhost:9093 describe --status

ЁЯУЛ Output (ржЙржжрж╛рж╣рж░ржг):
ClusterId: F6Yh3kQ0Tq2wQ
LeaderId: 1
LeaderEpoch: 5
HighWatermark: 20
Voters: [1,2,3]
Observers: []


LeaderId: ржмрж░рзНрждржорж╛ржирзЗ ржХрзЗ controller leader
leaderEPOCH how many times election occure  (Vutavuti hoise)
Voters: ржХрзЛржи ржХрзЛржи broker controller рж╣рж┐рж╕рзЗржмрзЗ ржнрзЛржЯрзЗ ржЕржВрж╢ ржирж┐ржЪрзНржЫрзЗ
HighWatermark: Raft log ржХрждржЯрж╛ ржкрж░рзНржпржирзНржд рж╕рж┐ржЩрзНржХ рж╣рзЯрзЗржЫрзЗ

ЁЯза рж╕ржВржХрзНрж╖рзЗржкрзЗ ржмрж╛ржВрж▓рж╛ рж╕ржВржЬрзНржЮрж╛:

Kafka Quorum рж╣рж▓рзЛ Kafka-ржПрж░ controller ржирзЛржбржЧрзБрж▓рзЛрж░ ржПржХржЯрж┐ ржжрж▓, ржпрж╛рж░рж╛ Raft algorithm ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ cluster-ржПрж░ metadata ржУ leader ржирж┐рж░рзНржмрж╛ржЪржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ, ржпрж╛рждрзЗ ржХрзЛржирзЛ node ржирж╖рзНржЯ рж╣рж▓рзЗржУ cluster ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рждрзЗ ржкрж╛рж░рзЗред
```
## cluser have one leader and other will be flower , flower store or replicate leader data to prevent fault tolarance.
```
рззя╕ПтГг Broker Role (ржбрзЗржЯрж╛ ржорзНржпрж╛ржирзЗржЬрж╛рж░)

ЁЯСЙ Broker рж╣рж▓рзЛ Kafka cluster-ржПрж░ ржорзВрж▓ рж╕рж╛рж░рзНржнрж╛рж░, ржпрзЗржЦрж╛ржирзЗ topics ржУ messages рж╕ржВрж░ржХрзНрж╖ржг рж╣рзЯред

тЪЩя╕П Broker-ржПрж░ ржорзВрж▓ ржХрж╛ржЬ:
ржХрж╛ржЬ	ржмрж░рзНржгржирж╛
ЁЯТ╛ Data рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рж╛	Producer ржпрзЗ message ржкрж╛ржарж╛рзЯ, Broker рждрж╛ topic ржУ partition ржЕржирзБржпрж╛рзЯрзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред
ЁЯУд Data ржкрж╛ржарж╛ржирзЛ (to consumer)	Consumer ржпржЦржи ржбрзЗржЯрж╛ ржкрзЬрзЗ, Broker рж╕рзЗржЯрж┐ ржкрж╛ржарж┐рзЯрзЗ ржжрзЗрзЯред
тЪб Replication рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛	ржЕржирзНржп broker-ржП partition-ржПрж░ ржХржкрж┐ (replica) рж╕рж┐ржЩрзНржХ рж░рж╛ржЦрзЗред
ЁЯзй Leader / Follower Partition ржкрж░рж┐ржЪрж╛рж▓ржирж╛	ржПржХрзЗржХржЯрж┐ partition-ржПрж░ ржЬржирзНржп ржПржХ broker leader ржерж╛ржХрзЗ, ржЕржирзНржпрж░рж╛ follower рж╣рж┐рж╕рзЗржмрзЗ ржерж╛ржХрзЗред
ЁЯзй ржЙржжрж╛рж╣рж░ржг:

ржзрж░рзЛ рждрзЛржорж╛рж░ topic orders ржПрж░ рзйржЯрж┐ partition ржЖржЫрзЗ тАФ

Partition 0 тЖТ Broker 1 (Leader)
Partition 1 тЖТ Broker 2 (Leader)
Partition 2 тЖТ Broker 3 (Leader)


ржПржЦржи ржкрзНрж░рждрж┐ржЯрж┐ broker рждрж╛рж░ partition ржЕржирзБржпрж╛рзЯрзА ржбрзЗржЯрж╛ рж░рж╛ржЦрзЗ ржПржмржВ replicate ржХрж░рзЗред

ЁЯзн рзия╕ПтГг Controller Role (ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ ржорзНржпрж╛ржирзЗржЬрж╛рж░)

ЁЯСЙ Controller рж╣рж▓рзЛ Kafka-ржПрж░ тАЬржорж╕рзНрждрж┐рж╖рзНржХтАЭ ЁЯза
ржПржЯрж┐ cluster-ржПрж░ metadata, broker status, ржПржмржВ leader election ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

тЪЩя╕П Controller-ржПрж░ ржорзВрж▓ ржХрж╛ржЬ:
ржХрж╛ржЬ	ржмрж░рзНржгржирж╛
ЁЯЧВя╕П Cluster metadata ржкрж░рж┐ржЪрж╛рж▓ржирж╛	ржХрзЛржи topic, partition, broker ржЖржЫрзЗ тАФ ржПржЗрж╕ржм рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред
ЁЯзСтАНтЪЦя╕П Leader election ржХрж░рж╛	ржХрзЛржирзЛ broker ржмрж╛ partition leader ржирж╖рзНржЯ рж╣рж▓рзЗ ржирждрзБржи leader ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗред
ЁЯЫая╕П Broker monitoring	ржХрзЛржи broker online/offline ржЖржЫрзЗ рждрж╛ ржиржЬрж░ рж░рж╛ржЦрзЗред
ЁЯФД Replication coordination	follower partition ржЧрзБрж▓рзЛ leader-ржПрж░ рж╕рж╛ржерзЗ sync ржЖржЫрзЗ ржХрж┐ ржирж╛ рждрж╛ ржжрзЗржЦрзЗред
ЁЯзй KRaft Mode-ржП Controller ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:

Kafka 3.x ржерзЗржХрзЗ ZooKeeper ржмрж╛ржж ржжрж┐рзЯрзЗ KRaft (Kafka Raft) ржмрзНржпржмрж╣рж╛рж░ рж╢рзБрж░рзБ рж╣рзЯред
ржПржЦрж╛ржирзЗ Controller-рж░рж╛ Raft consensus algorithm ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ metadata replicate ржУ leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗред

ЁЯСЙ ржПржЗ Controller-ржжрзЗрж░ ржжрж▓ржХрзЗржЗ ржмрж▓рж╛ рж╣рзЯ Controller Quorumред

тЪЦя╕П Broker vs Controller ржкрж╛рж░рзНржержХрзНржп ржЯрзЗржмрж┐рж▓рзЗ:
ржмрж┐рж╖рзЯ	Broker Role	Controller Role
ржХрж╛ржЬ	Data рж╕ржВрж░ржХрзНрж╖ржг ржУ ржкрж╛ржарж╛ржирзЛ	Metadata ржУ cluster coordination
ржЕржмрж╕рзНржерж╛ржи	Data plane	Control plane
Port (default)	9092	9093
рж╕ржВрж░ржХрзНрж╖рж┐ржд ржбрзЗржЯрж╛	Topics, partitions, messages	Broker info, topic configs, leaders
Leader/Follower	Partition level	Cluster level
ржмрзНржпржмрж╣рзГржд algorithm	Replication protocol	Raft consensus algorithm
ржкрзНрж░ржХрж╛рж░ рж╕ржВржЦрзНржпрж╛	ржЕржирзЗржХржЧрзБрж▓рзЛ broker ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗ	ржХрзЯрзЗржХржЯрж┐ controller (рж╕рж╛ржзрж╛рж░ржгржд 3 ржмрж╛ 5)
ЁЯУж рж╕рж╣ржЬржнрж╛ржмрзЗ ржоржирзЗ рж░рж╛ржЦрзЛ:

ЁЯз▒ Broker = ржбрзЗржЯрж╛ рж░рж╛ржЦрзЗ ржУ ржкрж╛ржарж╛рзЯ
ЁЯзн Controller = ржХрзЗ ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ рждрж╛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ

Broker (ржмрзНрж░рзЛржХрж╛рж░) тАУ ржбрзЗржЯрж╛ рж░рж╛ржЦрзЗ ржУ ржжрзЗрзЯ
ЁЯУЦ ржХрзА ржПржЯрж╛:

ЁЯСЙ Broker рж╣рж▓рзЛ Kafka-ржПрж░ ржПржХржЯрж┐ server ржмрж╛ node, ржпрж╛ message (data) рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗ ржПржмржВ producer ржУ consumer-ржПрж░ ржоржзрзНржпрзЗ data ржЖржжрж╛ржи-ржкрзНрж░ржжрж╛ржи ржХрж░рзЗред

тЪЩя╕П ржХрж╛ржЬ:
ржХрж╛ржЬ	ржмрж░рзНржгржирж╛
ЁЯТ╛ ржбрзЗржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг	Producer ржпрзЗ message ржкрж╛ржарж╛рзЯ, Broker рж╕рзЗржЯрж╛ topic ржУ partition ржЕржирзБржпрж╛рзЯрзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред
ЁЯУд Consumer-ржХрзЗ message ржкрж╛ржарж╛ржирзЛ	Consumer ржпржЦржи data ржкрзЬрзЗ, Broker рж╕рзЗржЗ message рждрж╛ржХрзЗ ржжрзЗрзЯред
ЁЯФБ Replication рж╣рзНржпрж╛ржирзНржбрж▓ ржХрж░рж╛	Partition-ржПрж░ leader broker рждрж╛рж░ follower broker-ржП data ржХржкрж┐ ржкрж╛ржарж╛рзЯред
ЁЯзй Partition leader рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рж╛	ржХрж┐ржЫрзБ partition-ржПрж░ ржЬржирзНржп broker leader рж╣рзЯ, ржЕржирзНржпржЧрзБрж▓рзЛрж░ ржЬржирзНржп followerред
ЁЯУж ржЙржжрж╛рж╣рж░ржг:

ржзрж░рзЛ рждрзЛржорж╛рж░ рзйржЯрж╛ broker ржЖржЫрзЗ ЁЯСЗ

Broker ID	Port	ржХрж╛ржЬ
1	9092	Leader of partition 0
2	9093	Follower of partition 0
3	9094	Follower of partition 0
ЁЯзн 2я╕ПтГг Controller (ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░) тАУ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░рзЗрж░ ржорж╕рзНрждрж┐рж╖рзНржХ ЁЯза
ЁЯУЦ ржХрзА ржПржЯрж╛:

ЁЯСЙ Controller рж╣рж▓рзЛ Kafka cluster-ржПрж░ leader manager,
ржпрзЗ ржкрзБрж░рзЛ cluster-ржПрж░ metadata ржУ leadership management ржирж┐рзЯржирзНрждрзНрж░ржг ржХрж░рзЗред

тЪЩя╕П ржХрж╛ржЬ:
ржХрж╛ржЬ	ржмрж░рзНржгржирж╛
ЁЯЧВя╕П Metadata ржкрж░рж┐ржЪрж╛рж▓ржирж╛	ржХрзЛржи topic, partition, broker ржЖржЫрзЗ тАФ ржПржЗ рждржерзНржп рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзЗред
тЪЦя╕П Leader election ржХрж░рзЗ	ржХрзЛржирзЛ broker ржирж╖рзНржЯ рж╣рж▓рзЗ ржирждрзБржи leader ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзЗред
ЁЯзСтАНЁЯТ╝ Broker monitor ржХрж░рзЗ	ржХрзЗ online/offline рж╕рзЗржЯрж╛ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рзЗред
ЁЯФД Replication coordinate ржХрж░рзЗ	follower broker-ржЧрзБрж▓рзЛ ржарж┐ржХржорждрзЛ leader-ржПрж░ data sync ржХрж░ржЫрзЗ ржХрж┐ржирж╛ рждрж╛ ржжрзЗржЦрзЗред
ЁЯУж KRaft Mode-ржП:

Kafka 3.x ржерзЗржХрзЗ ZooKeeper ржмрж╛ржж ржжрзЗржУрзЯрж╛ рж╣рзЯрзЗржЫрзЗ тАФ ржПржЦржи Controller ржХрж╛ржЬ ржХрж░рзЗ Raft algorithm ржжрж┐рзЯрзЗред
ржПржЦрж╛ржирзЗ Controller-рж░рж╛ ржПржХрж╕рж╛ржерзЗ ржерж╛ржХрзЗ ржПржХржЯрж┐ Quorum group рж╣рж┐рж╕рзЗржмрзЗ (ржпрзЗржоржи 3 controller node)ред

ЁЯФБ 3я╕ПтГг Follower (ржлрж▓рзЛрзЯрж╛рж░) тАУ ржХржкрж┐ржХрж╛рж░ржХ ЁЯУж
ЁЯУЦ ржХрзА ржПржЯрж╛:

ЁЯСЙ Follower рж╣рж▓рзЛ рж╕рзЗржЗ broker, ржпрзЗ leader broker-ржПрж░ data replicate (copy) ржХрж░рзЗ рж░рж╛ржЦрзЗред
ржПрждрзЗ ржХрж░рзЗ data ржирж┐рж░рж╛ржкржж ржерж╛ржХрзЗ ржПржмржВ fault tolerance ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯред

тЪЩя╕П ржХрж╛ржЬ:
ржХрж╛ржЬ	ржмрж░рзНржгржирж╛
ЁЯУе Leader-ржПрж░ data ржХржкрж┐ ржХрж░рж╛	Leader partition-ржПрж░ message follower ржирж┐ржЬрзЗрж░ ржХрж╛ржЫрзЗ ржХржкрж┐ ржХрж░рзЗ рж░рж╛ржЦрзЗред
ЁЯФД Sync ржерж╛ржХрж╛	Follower рж╕рж░рзНржмржжрж╛ leader-ржПрж░ рж╕рж╛ржерзЗ synchronized ржерж╛ржХрзЗ (latest message ржЕржирзБржпрж╛рзЯрзА)ред
ЁЯЫбя╕П Backup рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рж╛	ржпржжрж┐ leader broker ржирж╖рзНржЯ рж╣рзЯ, рждрж╛рж╣рж▓рзЗ follower ржирждрзБржи leader рж╣рждрзЗ ржкрж╛рж░рзЗред
ЁЯУж ржЙржжрж╛рж╣рж░ржг:

Topic orders ржПрж░ Partition-0:

Role	Broker ID	Description
Leader	Broker 1	ржорзВрж▓ message рж╕ржВрж░ржХрзНрж╖ржг ржХрж░ржЫрзЗ
Follower	Broker 2	Broker 1-ржПрж░ data ржХржкрж┐ ржХрж░ржЫрзЗ
Follower	Broker 3	Broker 1-ржПрж░ data ржХржкрж┐ ржХрж░ржЫрзЗ

тЬЕ ржпржжрж┐ Broker 1 ржмржирзНржз рж╣рзЯрзЗ ржпрж╛рзЯ тЖТ Broker 2 ржмрж╛ 3 ржирждрзБржи leader рж╣рзЯрзЗ ржпрж╛рзЯред

тЪЦя╕П рждрж┐ржиржЯрж┐рж░ ржкрж╛рж░рзНржержХрзНржп ржПржХрж╕рж╛ржерзЗ ржЯрзЗржмрж┐рж▓рзЗ:
ржмрж┐рж╖рзЯ	Broker	Controller	Follower
ржнрзВржорж┐ржХрж╛	ржбрзЗржЯрж╛ рж╕ржВрж░ржХрзНрж╖ржг ржУ ржЖржжрж╛ржиржкрзНрж░ржжрж╛ржи	Cluster metadata ржУ leader ржирж┐рж░рзНржмрж╛ржЪржи ржкрж░рж┐ржЪрж╛рж▓ржирж╛	Leader-ржПрж░ data replicate ржХрж░рзЗ
ржХрж╛ржЬрзЗрж░ ржзрж░ржи	Data plane	Control plane	Backup plane
Mode	Broker рж╣рж┐рж╕рзЗржмрзЗ ржЪрж▓рзЗ	KRaft ржмрж╛ ZooKeeper mode-ржП controller	Broker-ржПрж░ ржЕржВрж╢
Port	рж╕рж╛ржзрж╛рж░ржгржд 9092	рж╕рж╛ржзрж╛рж░ржгржд 9093	Broker-ржПрж░ ржорждрзЛржЗ
рж╕ржВржЦрзНржпрж╛	ржЕржирзЗржХ (рзй ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐)	рж╕рж╛ржзрж╛рж░ржгржд рзй (quorum group)	ржкрзНрж░рждрж┐ржЯрж┐ partition-ржП рзз+
Replication	ржбрзЗржЯрж╛ replicate ржХрж░рзЗ	Replication coordinate ржХрж░рзЗ	Replicate ржХрж░рж╛ ржбрзЗржЯрж╛ рж░рж╛ржЦрзЗ
Leader election	Controller ржжрзНржмрж╛рж░рж╛ ржирж┐рж░рзНржзрж╛рж░рж┐ржд	ржирж┐ржЬрзЗ election ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ	Leader fail рж╣рж▓рзЗ ржирждрзБржи leader рж╣рзЯ
ЁЯза рж╕рж╣ржЬржнрж╛ржмрзЗ ржоржирзЗ рж░рж╛ржЦрзЛ:

ЁЯФ╕ Broker тЖТ ржбрзЗржЯрж╛ рж░рж╛ржЦрзЗ ржУ ржжрзЗрзЯ
ЁЯФ╕ Controller тЖТ ржХрзЗ ржХрзА ржХрж░ржмрзЗ рждрж╛ ржарж┐ржХ ржХрж░рзЗ
ЁЯФ╕ Follower тЖТ Leader-ржПрж░ ржХржкрж┐ рж░рж╛ржЦрзЗ, ржкрзНрж░рзЯрзЛржЬржирзЗ рждрж╛рж░ ржЬрж╛рзЯржЧрж╛ ржирзЗрзЯ

Controller (ржХржирзНржЯрзНрж░рзЛрж▓рж╛рж░)

ЁЯСЙ Kafka cluster-ржПрж░ тАЬmanagerтАЭ ржмрж╛ тАЬржорж╕рзНрждрж┐рж╖рзНржХтАЭред

ЁЯза ржХрж╛ржЬ:

ржкрзБрж░рзЛ cluster metadata (topic, partition, broker info) ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

ржХрзЛржирзЛ broker ржмрж╛ partition leader fail ржХрж░рж▓рзЗ ржирждрзБржи leader ржирж┐рж░рзНржмрж╛ржЪржи ржХрж░рзЗред

Broker ржЧрзБрж▓рзЛ online/offline ржЖржЫрзЗ ржХрж┐ ржирж╛, рж╕рзЗржЯрж┐ ржоржирж┐ржЯрж░ ржХрж░рзЗред

ЁЯУМ Controller ржкрзБрж░рзЛ ржХрзНрж▓рж╛рж╕рзНржЯрж╛рж░ржХрзЗ manage ржХрж░рзЗред

ЁЯСС 2я╕ПтГг Leader (рж▓рж┐ржбрж╛рж░)

ЁЯСЙ ржкрзНрж░рждрж┐ржЯрж┐ partition-ржПрж░ ржЬржирзНржп ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржПржХржЯрж┐ broker leader рж╣рзЯред

тЪЩя╕П ржХрж╛ржЬ:

Producer ржпрзЗ data ржкрж╛ржарж╛рзЯ, рж╕рзЗржЯрж╛ leader partition ржЧрзНрж░рж╣ржг ржХрж░рзЗред

Consumers message ржкрзЬрж▓рзЗ, рж╕рзЗржЯрж╛ржУ leader broker ржерзЗржХрзЗ ржкрзЬрзЗред

Leader рждрж╛рж░ follower-ржжрзЗрж░ ржХрж╛ржЫрзЗ data replicate ржХрж░рзЗред

ЁЯУМ Leader рж╢рзБржзрзБ ржПржХржЯрж┐ partition-ржПрж░ data ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗред

тЪЦя╕П рж╕ржВржХрзНрж╖рзЗржкрзЗ ржкрж╛рж░рзНржержХрзНржп:
ржмрж┐рж╖рзЯ	Controller	Leader
ржнрзВржорж┐ржХрж╛	Cluster manager	Partition manager
ржХрж╛ржЬрзЗрж░ ржХрзНрж╖рзЗрждрзНрж░	ржкрзБрж░рзЛ Kafka cluster	ржирж┐рж░рзНржжрж┐рж╖рзНржЯ topic partition
рж╕ржВржЦрзНржпрж╛	рззржЯрж┐ (ржмрж╛ ржХрзЯрзЗржХржЯрж┐ controller quorum)	ржкрзНрж░рждрж┐ржЯрж┐ partition-ржПрж░ ржЬржирзНржп рззржЯрж┐
ржжрж╛рзЯрж┐рждрзНржм	Leader ржирж┐рж░рзНржмрж╛ржЪржи, broker tracking	Data handle ржХрж░рж╛
ржЙржжрж╛рж╣рж░ржг	Broker 1 Controller рж╣рждрзЗ ржкрж╛рж░рзЗ	Broker 2 Partition-0-ржПрж░ Leader рж╣рждрзЗ ржкрж╛рж░рзЗ

ЁЯОп рж╕рж╣ржЬржнрж╛ржмрзЗ ржоржирзЗ рж░рж╛ржЦрзЛ:

ЁЯзн Controller = ржХрзЗ leader рж╣ржмрзЗ рждрж╛ ржарж┐ржХ ржХрж░рзЗ
ЁЯСС Leader = data handle ржХрж░рзЗ
```

### if we want to create multiple node or server in a cluster we should have create server.property for each node or server.
```
Go 
config>> server.property 
copy it for each node
configure node no, port,log file 

```
### To create multiple node in a cluster we have to write 
 create odd number node in a cluster.  i create  like 3 nodes .
```
C:\kafka>.\bin\windows\kafka-storage.bat format --cluster-id sdlcpro-01521122140 --initial-controllers 111@localhost:9093:dvvIe3AwR4-ycio5syoq4g,222@localhost:9095:0Y_aMQ_aR2i2QshS2cXJyw,333@localhost:9097:Ajw-zSkdTrmUoBS0sh_TwQ --config ./config/server_111.properties
C:\kafka>.\bin\windows\kafka-storage.bat format --cluster-id sdlcpro-01521122140 --initial-controllers 111@localhost:9093:dvvIe3AwR4-ycio5syoq4g,222@localhost:9095:0Y_aMQ_aR2i2QshS2cXJyw,333@localhost:9097:Ajw-zSkdTrmUoBS0sh_TwQ --config ./config/server_222.properties
C:\kafka>.\bin\windows\kafka-storage.bat format --cluster-id sdlcpro-01521122140 --initial-controllers 111@localhost:9093:dvvIe3AwR4-ycio5syoq4g,222@localhost:9095:0Y_aMQ_aR2i2QshS2cXJyw,333@localhost:9097:Ajw-zSkdTrmUoBS0sh_TwQ --config ./config/server_333.properties
```
## Run theses nodes
```
.\bin\windows\kafka-server-start.bat .\config\server_111.properties
.\bin\windows\kafka-server-start.bat .\config\server_222.properties
.\bin\windows\kafka-server-start.bat .\config\server_333.properties

```
## if we want to see  details 
```
C:\kafka>.\bin\windows\kafka-metadata-quorum.bat --bootstrap-controller localhost:9093 describe --status
```
## if we want to see flower or leader details 
```
C:\kafka>.\bin\windows\kafka-metadata-quorum.bat --bootstrap-controller localhost:9093 describe --replication
```





